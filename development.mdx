---
title: 'Development'
description: 'Set up your local development environment for CryptoLay'
---

# Development Guide

This guide covers setting up your local development environment for contributing to CryptoLay.

## Prerequisites

Before you begin, ensure you have the following installed:

- **Node.js 18+** - [Download here](https://nodejs.org/)
- **Docker & Docker Compose** - [Download here](https://www.docker.com/products/docker-desktop/)
- **PostgreSQL** - Included with Docker setup
- **Git** - [Download here](https://git-scm.com/)

## Local Development Setup

### 1. Clone the Repository

```bash
git clone https://github.com/TorresAndy/cryptolay.git
cd cryptolay
```

### 2. Start the Database

```bash
docker-compose up postgres -d
```

This starts a PostgreSQL database on port 5432 with the following credentials:
- **Host**: localhost
- **Port**: 5432
- **Database**: cryptolay
- **Username**: postgres
- **Password**: password

### 3. Apply Database Schema

```bash
psql -h localhost -U postgres -d cryptolay -f database/schema.sql
```

If you don't have `psql` installed, use Docker:

```bash
docker exec -i cryptolay_postgres_1 psql -U postgres -d cryptolay < database/schema.sql
```

### 4. Environment Configuration

Create environment files for each service:

#### Main API (.env)

```env
DATABASE_URL=postgresql://postgres:password@localhost:5432/cryptolay
AWS_REGION=us-east-1
AWS_ACCESS_KEY_ID=your_key
AWS_SECRET_ACCESS_KEY=your_secret
NODE_ENV=development
JWT_SECRET=your_jwt_secret_here
```

#### Frontend Apps (.env.local)

```env
NEXT_PUBLIC_API_URL=http://localhost:3000
NODE_ENV=development
```

### 5. Install Dependencies

```bash
# Main API
cd main-api
npm install

# Customer Admin
cd ../customer-admin
npm install

# System Admin
cd ../system-admin
npm install

# Landing Page
cd ../landing-page
npm install
```

### 6. Start Development Servers

#### Main API

```bash
cd main-api
npm run dev
```

The API will be available at `http://localhost:3000`.

#### Customer Admin Dashboard

```bash
cd customer-admin
npm run dev
```

Access at `http://localhost:3001`.

#### System Admin Dashboard

```bash
cd system-admin
npm run dev
```

Access at `http://localhost:3002`.

#### Landing Page

```bash
cd landing-page
npm run dev
```

Access at `http://localhost:3003`.

## Development Workflow

### Running Tests

```bash
# Main API tests
cd main-api
npm test

# Frontend tests
cd ../customer-admin
npm test

cd ../system-admin
npm test
```

### Database Migrations

When you need to make database changes:

1. Create a new migration file in `database/migrations/`
2. Apply the migration:

```bash
psql -h localhost -U postgres -d cryptolay -f database/migrations/your_migration.sql
```

### Code Quality

#### Linting

```bash
# Main API
cd main-api
npm run lint

# Frontend apps
cd ../customer-admin
npm run lint
```

#### Type Checking

```bash
# Customer Admin
cd customer-admin
npm run type-check

# System Admin
cd ../system-admin
npm run type-check
```

## Architecture Overview

### Service Structure

```
cryptolay/
├── main-api/           # Node.js Lambda API
│   ├── src/
│   │   ├── handlers/   # API route handlers
│   │   ├── lib/        # Shared utilities
│   │   └── server.js   # Express server
│   └── package.json
├── customer-admin/     # Next.js customer dashboard
├── system-admin/       # Next.js admin interface
├── landing-page/       # Next.js public website
├── database/          # Database schema and migrations
└── scripts/           # Setup and utility scripts
```

### API Structure

The main API follows a modular structure:

- **Handlers**: Route handlers organized by feature
- **Lib**: Shared utilities (database, crypto, auth)
- **Middleware**: Request processing and validation

### Database Design

- **customers**: Customer account information
- **users**: User accounts within organizations
- **api_keys**: API key management
- **manifests**: Encryption configuration
- **request_logs**: Audit trail and monitoring

## Testing

### API Testing

```bash
cd main-api
npm run test:local
```

### Integration Testing

```bash
# Start all services
docker-compose up -d

# Run integration tests
npm run test:integration
```

### Load Testing

```bash
# Install artillery
npm install -g artillery

# Run load tests
artillery run tests/load/encryption.yml
```

## Debugging

### API Debugging

Add debug logging:

```javascript
const debug = require('debug')('cryptolay:api');

// In your handler
debug('Processing encryption request', { manifestId, data });
```

### Database Debugging

Enable query logging:

```bash
psql -h localhost -U postgres -d cryptolay -c "SET log_statement = 'all';"
```

### Frontend Debugging

Use React Developer Tools and browser dev tools for frontend debugging.

## Performance Optimization

### Database Optimization

```bash
# Apply optimization queries
psql -h localhost -U postgres -d cryptolay -f database/optimization_queries.sql
```

### API Performance

- Use connection pooling
- Implement caching where appropriate
- Monitor query performance

### Frontend Optimization

- Code splitting with Next.js
- Image optimization
- Bundle analysis

## Security Considerations

### Local Development

- Use mock KMS for local development
- Don't commit real API keys
- Use environment variables for secrets

### Testing Security

```bash
# Run security tests
npm run test:security
```

## Deployment

### Local Docker Deployment

```bash
# Build and start all services
docker-compose up --build

# Start individual services
docker-compose up main-api customer-admin system-admin landing-page
```

### Production Deployment

See the [Deployment Guide](/deployment) for production deployment instructions.

## Contributing

### Code Style

- Follow the existing code style
- Use Prettier for formatting
- Run linting before committing

### Git Workflow

1. Create a feature branch
2. Make your changes
3. Add tests
4. Run the test suite
5. Submit a pull request

### Documentation

- Update documentation for any API changes
- Add examples for new features
- Keep the README up to date

## Troubleshooting

### Common Issues

#### Database Connection

```bash
# Check if PostgreSQL is running
docker ps

# Restart the database
docker-compose restart postgres
```

#### Port Conflicts

If ports are already in use:

```bash
# Find processes using the port
lsof -i :3000

# Kill the process
kill -9 <PID>
```

#### Node Modules Issues

```bash
# Clear node modules and reinstall
rm -rf node_modules package-lock.json
npm install
```

### Getting Help

- Check the [API Reference](/api-reference/authentication)
- Review existing issues on GitHub
- Contact the development team

## Next Steps

<CardGroup cols={2}>
  <Card
    title="API Reference"
    href="/api-reference/authentication"
    icon="code"
  >
    Explore the complete API documentation
  </Card>
  <Card
    title="Deployment Guide"
    href="/deployment"
    icon="rocket"
  >
    Learn about production deployment
  </Card>
</CardGroup>
